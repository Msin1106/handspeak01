<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>HandSpeak (JS, no‚Äëcv2) ‚Äî Ng√¥n ng·ªØ h√¨nh th·ªÉ ‚Üí Ti·∫øng Vi·ªát</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- ===== Styles ===== -->
  <style>
    :root{
      --bg:#0f1115; --panel:#151923; --ink:#e6e9ef; --muted:#9aa5b1; --acc:#36d399; --ring:#2c3342;
    }
    *{box-sizing:border-box}
    html, body { margin:0; background:var(--bg); color:var(--ink); font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
    a{color:var(--acc); text-decoration:none}
    main { display:flex; flex-direction:column; gap:18px; padding:18px; max-width:1200px; margin:0 auto; }
    header{display:flex; gap:16px; align-items:center; justify-content:space-between}
    nav{display:flex; flex-wrap:wrap; gap:8px}
    nav button{background:#1d2330;border:1px solid var(--ring);color:var(--ink);padding:8px 12px;border-radius:8px;cursor:pointer}
    nav button.active{border-color:var(--acc); box-shadow:0 0 0 1px var(--acc) inset}
    section.panel{background:var(--panel); border:1px solid var(--ring); border-radius:12px; padding:16px}
    h2{margin:0 0 6px 0; font-size:20px}
    .hint{color:var(--muted); font-size:14px}
    /* Stage (Practice) */
    #stage { position:relative; width: min(96vw, 960px); aspect-ratio: 16/9; background:#000; border-radius:12px; overflow:hidden; box-shadow:0 0 0 1px var(--ring) inset; margin:10px 0 }
    #stage video, #stage canvas { position:absolute; inset:0; width:100%; height:100%; }
    #banner { position:absolute; left:12px; top:12px; padding:8px 12px; background:rgba(0,0,0,.6); border-radius:10px; font-weight:600; backdrop-filter: blur(6px) }
    #controls { display:flex; flex-wrap:wrap; align-items:center; gap:12px; }
    #controls .group{display:flex; align-items:center; gap:8px}
    #vol-val{ color:var(--muted); min-width:46px; text-align:right }
    input[type=range]{ width:180px }
    button, label { background:#1d2330; border:1px solid var(--ring); color:var(--ink); padding:8px 12px; border-radius:8px; cursor:pointer }
    button:hover{ border-color:#3b4358 }
    .switch{position:relative;display:inline-block;width:44px;height:24px}
    .switch input{opacity:0;width:0;height:0}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#394050;transition:.2s;border-radius:999px}
    .slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;top:3px;background:white;transition:.2s;border-radius:50%}
    .switch input:checked + .slider{background:var(--acc)}
    .switch input:checked + .slider:before{transform:translateX(20px)}
    /* Learn cards */
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px}
    .card{background:#101521;border:1px solid var(--ring); border-radius:10px; padding:12px}
    .card h4{margin:6px 0 4px 0}
    .card .badge{display:inline-block; padding:2px 8px; border-radius:999px; background:#1e2637; border:1px solid var(--ring); font-size:12px; margin-right:6px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#1e2637; border:1px solid #2a3346; padding:2px 6px; border-radius:6px}
    .two-col{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    @media (max-width: 900px){ .two-col{grid-template-columns:1fr} }
    img.round{border-radius:10px; border:1px solid var(--ring); width:100%; height:auto}
  </style>

  <!-- ===== MediaPipe (Hands) ===== -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.min.js"></script>
</head>
<body>
<main>
  <header>
    <div>
      <h1 style="margin:0;font-size:22px">üñêÔ∏è HandSpeak ‚Äì Ng√¥n ng·ªØ h√¨nh th·ªÉ ‚Üí Gi·ªçng n√≥i</h1>
      <div class="hint">Demo ch·∫°y tr√™n tr√¨nh duy·ªát: Camera ‚ûú Mediapipe ‚ûú VƒÉn b·∫£n ‚ûú Gi·ªçng n√≥i (TTS). <span class="kbd">no‚Äëcv2</span></div>
    </div>
    <nav>
      <button data-tab="intro" class="active">Gi·ªõi thi·ªáu</button>
      <button data-tab="learn">H·ªçc & Tra c·ª©u</button>
      <button data-tab="practice">Th·ª±c h√†nh</button>
      <button data-tab="impact">√ù nghƒ©a</button>
    </nav>
  </header>

  <section class="panel" id="tab-intro">
    <!-- content omitted for brevity; same as user's -->
    <h2>1) Gi·ªõi thi·ªáu</h2>
    <p>Trang ƒë√£ ƒë∆∞·ª£c n√¢ng c·∫•p ƒë·ªÉ ƒë·ªçc ti·∫øng Vi·ªát chu·∫©n h∆°n.</p>
  </section>

  <section class="panel" id="tab-practice" hidden>
    <h2>3) Th·ª±c h√†nh v·ªõi camera</h2>
    <div class="hint">Cho ph√©p camera. Khi nh·∫≠n c·ª≠ ch·ªâ, trang s·∫Ω hi·ªÉn th·ªã c√¢u v√† ƒë·ªçc ti·∫øng Vi·ªát.</div>
    <div id="stage">
      <video id="video" class="input_video" playsinline autoplay muted></video>
      <canvas id="canvas" class="output_canvas"></canvas>
      <div id="banner">ƒêang kh·ªüi ƒë·ªông‚Ä¶</div>
    </div>
    <div id="controls">
      <div class="group">
        <label class="switch"><input type="checkbox" id="toggle-audio" checked /><span class="slider"></span></label>
        <span>B·∫≠t √¢m thanh</span>
      </div>
      <div class="group">
        <button id="vol-dec">‚àí</button>
        <input type="range" id="vol" min="0" max="1" step="0.05" value="1">
        <button id="vol-inc">+</button>
        <span id="vol-val">100%</span>
      </div>
      <div class="group">
        <button id="btn-test-voice">Test ti·∫øng n√≥i</button>
        <button id="btn-reset">Reset v·∫´y tay</button>
        <button id="btn-download-log">T·∫£i log CSV</button>
      </div>
    </div>
  </section>
</main>

<script>
  // Tabs
  const tabs = {intro:'tab-intro', practice:'tab-practice'};
  document.querySelectorAll('nav button').forEach(btn=>{
    btn.onclick = ()=>{
      document.querySelectorAll('nav button').forEach(b=>b.classList.toggle('active', b===btn));
      const key = btn.dataset.tab;
      for(const k in tabs){ document.getElementById(tabs[k]).hidden = (k!==key); }
    };
  });

  // Practice logic (simplified)
  const PHRASE_MAP = { WAVE:"Xin ch√†o!", OPEN_PALM:"Ch√†o b·∫°n!", STOP:"D·ª´ng l·∫°i!", THUMBS_UP:"T·ªët l·∫Øm!", OK:"OK!", VICTORY:"Tuy·ªát v·ªùi!", FIST:"Xin l·ªói!", POINT:"·ªû kia!", SHAKA:"K·∫øt n·ªëi nh√©!" };
  const videoEl=document.getElementById('video'), canvasEl=document.getElementById('canvas'), bannerEl=document.getElementById('banner');
  const audioToggle=document.getElementById('toggle-audio'); const volSlider=document.getElementById('vol'); const volVal=document.getElementById('vol-val');
  const btnDec=document.getElementById('vol-dec'), btnInc=document.getElementById('vol-inc'); const btnReset=document.getElementById('btn-reset'), btnTest=document.getElementById('btn-test-voice'), btnDownload=document.getElementById('btn-download-log');
  let currentVolume=1.0; function banner(t){ bannerEl.textContent=t } function clamp(v,min,max){ return Math.max(min,Math.min(max,v)) } function applyVolumeUI(){ volVal.textContent = Math.round(currentVolume*100)+"%"; volSlider.value=String(currentVolume); }

  function speakVI(text){
    if(!audioToggle.checked) return;
    if (window.speakVi){ window.speakVi(text,{ cancelBeforeSpeak:true, volume: currentVolume }); }
    else { const u=new SpeechSynthesisUtterance(text); u.lang='vi-VN'; u.volume=currentVolume; speechSynthesis.cancel(); speechSynthesis.speak(u); }
  }

  btnReset.onclick=()=>{ banner("ƒê√£ reset"); };
  btnTest.onclick=()=> speakVI("Xin ch√†o! ƒê√¢y l√† b·∫£n ki·ªÉm tra √¢m thanh ti·∫øng Vi·ªát.");
  btnDownload.onclick=()=>{ banner("Ch∆∞a c√≥ log trong b·∫£n r√∫t g·ªçn."); };
  function onVolInput(v){ currentVolume = clamp(parseFloat(v||"1"),0,1); applyVolumeUI(); }
  volSlider.addEventListener('input', e=> onVolInput(e.target.value)); btnDec.addEventListener('click', ()=> onVolInput((currentVolume-0.1).toFixed(2))); btnInc.addEventListener('click', ()=> onVolInput((currentVolume+0.1).toFixed(2)));

  window.addEventListener('DOMContentLoaded', ()=>{
    applyVolumeUI();
    banner("S·∫µn s√†ng. Chuy·ªÉn sang tab 'Th·ª±c h√†nh' ƒë·ªÉ th·ª≠.");
  });
</script>

<!-- Vietnamese TTS robust helper -->
<script src="vi-tts-helper.js"></script>
</body>
</html>
